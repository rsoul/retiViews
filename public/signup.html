<html>
<head>
  <style type="text/css">
  .mapboxgl-marker {
    width: 13px;
    height: 13px;
    border-radius: 50%;
    border:1px solid #fff;
    position='absolute';}
  #logo{
    color:#fff;
    font-family: 'IBM Plex Serif',
    serif;
    font-size:40pt;
    padding-top:35px;
    padding-bottom: 20px;
    font-weight: 600;
    font-style: italic; 
  }
  .event{
    padding-bottom: 10px;
  }
  .r-titles{
    color:#fff;
    font-family: 'Quicksand', 
    sans-serif;
    font-size:15pt;
    
    padding-bottom: 10px;
    font-wight:800; 

  }
  .r-text{
    color:#fff;
    font-family: 'IBM Plex Serif',
    serif;
    font-size:40pt;
    padding-top:25px;
    padding-bottom: 20px;
    font-weight: 600;
    font-style: italic;}
  .l-text{}
  .l-titles{
    color:#000;
    font-family: 'Quicksand', 
    sans-serif;
    font-size:15pt;
    padding-top:10px;
    font-weight:500;
  }

  </style>
	
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif|Quicksand" rel="stylesheet">

	<script src='https://api.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>
  <link href='//mapbox.com/base/latest/base.css' rel='stylesheet' />
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.slim.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css' rel='stylesheet'/>
  <link rel="shortcut icon" type="image/x-icon" href="https://static.squarespace.com/universal/default-favicon.ico">

  <script>
    var cars=[];
    var trips=[];
    var socket = io();
    socket.on('car-info',(data)=>{
      obj=JSON.parse(data);

      var el = document.createElement('div');
      el.style.backgroundColor=obj.color;
      new mapboxgl.Marker(el,).setLngLat(obj.pos).addTo(map);

    })


    
    socket.on('route',(routeURL,color)=>{
       $.ajax({method: 'GET',url: routeURL}).done((data)=>{
        console.log();
        map.addLayer({id: 'route'+Math.random(),type:'line',source:{type:'geojson',data:{type:'Feature',geometry: data.routes[0].geometry}},paint:{'line-width': 2.5,'line-color':color}});
       })


     })
    
    function updateLivefeed(event){
      if ($('#livefeed').lengh>50){
        $('#livefeed').children().last().remove();
      }
      
      $(event).hide().prependTo('#livefeed').fadeIn(800);
    }
  </script>
</head>

<body>
	
	
  <div style="height: 100%">
  <div id='map' style="height: 100%"></div>
  <div class='pin-right pad2'>
    
  </div>
  <div id='step-4' class='col3 pad2 fill-darken1 pin-left offcanvas-left animate'>
    <a href='#' class='contain fill-darken2 pad1 icon close'></a>
    <h1 id='logo'>Car nÂ° 56 </h1>
    <div class='pad2 fill-yellow' style="width: 100%">
    <h3 class='fancy' style="font-size:20px">NOT AVAILABLE</h3></div>

    <div class='pad2 fill-mustard' style="width: 100%">
    <h3 class='fancy' style="font-size:20px">FUEL LEVEL: 56%</h3></div>

    <div class='pad2 fill-orange' style="width: 100%">
    <h3 class='fancy' style="font-size:20px">IN USE BY: Marco Piazza</h3></div>

    <div class='pad2 fill-red' >
    <h3 class='fancy' style="font-size:20px">DESTINATION:</h3><fieldset>
  <input type='text' value='' / class="stretch dark input">
</fieldset></div>
    <div style="padding-top: 20px"><a class='button'> BOOK </a></div>
    

    
</div>
  </div>
  <div id="r-panel" class='col2 pad2 fill-darken3 pin-right'>
    <a href='#step-4' class='button'>Log out</a>
    <h2 id='logo'>Vie.ws</h2>
    <h3 class='r-titles'> ACTIVE TRIPS</h4>
    <h2 class='r-text'>7</h2>
    <h3 class='r-titles'> LIVE EVENTS</h3>
    


    <div id='livefeed' style="overflow: scroll;height: 60%">
      <div class='event'>
        <code class='fill-orange'>New Booking!</code>
        <p style="color:#fff"> A robot ðŸ¤– just booked car nÂ° 34</p>
      </div>
      <div class='event'>
        <code class='fill-pink'>User logged in!</code>
        <p style="color:#fff"> Marco Piazza just logged in!</p>
      </div>
      <div class='event'>
        <code class='fill-teal'>Trip Completed!</code>
        <p style="color:#fff"> Luca Ambrogio just arrived to his destination!</p>
      </div>
      <div class='event'>
        <code class='fill-green'>User logged out!</code>
        <p style="color:#fff"> Raoul Nuccetelli just arrived to his destination!</p>
      </div>
  </div>
   </div>

</div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoicnNvdWxsIiwiYSI6ImNqa2l3c2F0dTFhMTkza28zNXhnMjZ4b3UifQ.EuutLwZpj-2ZD5LVZiDlvw';
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v9',
    maxZoom: 15,
    minZoom: 1,
    attributionControl: false
  }).setCenter([12.50,41.89]).setZoom(10.8);

</script>

</body>

</html>